"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58],{7397:function(e,t,r){r.d(t,{LX:function(){return T},pA:function(){return c.pA},pF:function(){return c.pF}});var n=r(7437),l=r(4012),i=r(5161),a=r(7945),o=r(2265),s=r(3887),u=r(9968),c=r(869),d=r(2582),f=r(7704),p=r(6242),h=r(3578),x=r(6094);let m="Arial",g=d.lU;function v(e){return e.height/2-50-80}function b(e){return e.height/2+50}function k(){return 100+d.lU}function j(){return k()+3*d.lU}function y(e){let t=(0,h.SQ)(e.keySignature).notes.length;return j()+t*d.lU+d.lU}function w(e){return y(e)+4*d.lU}let N={primary:"121,74,227",hover:"185,154,244",disabled:"100,100,100",black:"0,0,0"},S={A:"12,23,141",B:"75,32,139",C:"217,59,38",D:"238,151,56",E:"253,229,65",F:"62,139,38",G:"139,210,250"};function R(e,t){let r=t.time*e.pps-e.viewport.start,n=r+("note"===t.type?t.duration:100)*e.pps;return{start:r,end:n}}function C(e,t){t.addColorStop(0,`rgba(${e},0)`),t.addColorStop(.5,`rgba(${e},0.1)`),t.addColorStop(.8,`rgba(${e},0.3`),t.addColorStop(1,`rgba(${e},1)`)}function P(e,t){return e?S[t]:N.black}var T=function({song:e,config:t,hand:r,handSettings:S,selectedRange:T,getTime:D,constrictView:U=!0,enableTouchscroll:E=!1,game:O=!1}){let{width:M,height:$,measureRef:z}=(0,a.tH)(),L=(0,o.useRef)(),Z=(0,s.nn)(),B=(0,o.useMemo)(()=>{var e;return(null===(e=L.current)||void 0===e?void 0:e.getBoundingClientRect())??{}},[M,$]);return(0,n.jsx)("div",{className:"absolute h-full w-full touch-none",ref:z,onPointerMove:e=>E&&i.ER(Z,e.nativeEvent),onPointerDown:e=>E&&i.DZ(Z,e.nativeEvent),onPointerUp:e=>E&&i.vo(Z,e.nativeEvent),children:(0,n.jsx)(l.Xz,{ref:L,render:function(n,{width:l,height:i}){var a;e&&("falling-notes"===(a={time:D(),visualization:t.visualization,drawNotes:t.noteLetter,coloredNotes:t.coloredNotes,windowWidth:l,height:i,pps:c.i6,hands:S,hand:r,ctx:n,items:e.items,constrictView:!!U,keySignature:t.keySignature??e.keySignature,timeSignature:e.timeSignature,canvasRect:B,selectedRange:T,game:O,player:Z}).visualization?(0,u.B0)(a):function(e){let t={...e,viewport:{start:e.time*e.pps,end:e.time*e.pps+(e.windowWidth-100)}};t.ctx.clearRect(0,0,t.windowWidth,t.height),function(e){let{ctx:t}=e;t.fillStyle="black",t.strokeStyle="black";let r=v(e),n=b(e);(0,d.jp)(e.ctx,100,r,e.windowWidth),(0,d.jp)(e.ctx,100,n,e.windowWidth)}(t);let r=(0,c.EF)(t,e=>R(t,e).end>=0,e=>R(t,e).start>t.windowWidth);for(let e of r)"measure"!==e.type&&function(e,t){var r;let{ctx:n,pps:l,keySignature:i}=e,a=R(e,t).start,o=(null===(r=e.hands)||void 0===r?void 0:r[t.track].hand)==="right"?"treble":"bass",s="treble"===o?v(e):b(e),u=w(e),c=a+u+p.Xv/2,f=n.createLinearGradient(u-2*d.lU,0,u,0);C("0,0,0",f),n.fillStyle=f,n.strokeStyle=f,(0,p._e)(n,c-d.lU,2*d.lU,s,t.midiNote,o,e.keySignature)}(t,e);for(let e of r)"measure"!==e.type&&function(e,t){var r,n,l,i,a;let{ctx:o,pps:u,keySignature:c}=e;o.save();let g=Math.round(u*t.duration),k=R(e,t).start;(i=k)+(a=g)<0||i>=0||(0,f.B_)("#8147EB","#000000",Math.max((i+a)/a,.15));let j=(null===(r=e.hands)||void 0===r?void 0:r[t.track].hand)==="right"?"treble":"bass",y="treble"===j?v(e):b(e),S=w(e),T=k+S+p.Xv/2,D=(0,p.Ib)(t.midiNote,j,y,c),U=(0,h.km)(t.midiNote,e.keySignature),E=e.game?function(e,t,r){let n=w(e);return(0,s.K9)(e.player,t)&&x.ZP.getPressedNotes().has(t.midiNote)?N.hover:(0,s.Rj)(e.player,t)?N.disabled:r<=n?N.primary:N.black}(e,t,T):(n=e.coloredNotes,l=U[0],T<=w(e)?N.primary:P(n,l)),O=g-d.lU,M=o.createLinearGradient(S-2*d.lU,0,S,0);if(C(E,M),o.fillStyle=M,o.strokeStyle=M,o.fillRect(T+d.lU/2,D-5,O,10),o.globalCompositeOperation="source-over",T<S-2*d.lU){o.restore();return}(0,p.bQ)(o,T,D,M);let $=2==U.length&&U[1];if($){let e="#"===$?h.pE.accidentalSharp:h.pE.accidentalFlat,t=T-(d.lU+8);(0,p.l_)(o,e,t,D,64,M)}if(e.drawNotes){o.font=`9px ${m}`,o.fillStyle="white";let e=U[0];o.fillText(e,T,D+3)}o.restore()}(t,e);(function(e){let{ctx:t,keySignature:r}=e,n=w(e)-2*d.lU;t.clearRect(0,0,n,e.height),t.fillStyle="black",t.strokeStyle="black";let l=e.height/2+130;(0,d.NS)(e.ctx,75,l,260);let i=v(e),a=b(e);(0,d.jp)(e.ctx,100,i,n),(0,d.jp)(e.ctx,100,a,n),(0,d.d4)(e.ctx,100,i-1,a+80+1);let o=i-g,s=a+80+g;if((0,d.Qb)(t,w(e)-2,o,s),(0,d.p5)(t,k(),i),(0,d.oN)(t,k(),a),(0,d.B8)(t,j(),i,r,"treble"),(0,d.B8)(t,j(),a,r,"bass"),e.timeSignature){let r=y(e);(0,d.eN)(t,r,i,e.timeSignature),(0,d.eN)(t,r,a,e.timeSignature)}})(t),function(e,t){let{ctx:r}=e;for(let l of x.ZP.getPressedNotes().keys()){let i=l<(0,h.qC)("C4")?"bass":"treble",a=t.find(e=>"note"===e.type&&e.midiNote===+l);if(a){var n;i=(null===(n=e.hands)||void 0===n?void 0:n[a.track].hand)==="right"?"treble":"bass"}if(e.game&&(0,s.K9)(e.player,a))return;let o="bass"===i?b(e):v(e),u=(0,p.Ib)(l,i,o),c=w(e)-2,d=(0,h.km)(l);if((0,p.bQ)(r,c,u,e.coloredNotes?`rgba(${P(!0,d[0])},1)`:"red"),2===d.length){let t=e.coloredNotes?`rgba(${P(!0,d[0])},1)`:"black";(0,p.l_)(r,h.pE.accidentalSharp,c-24,u,48,t)}e.drawNotes&&(r.font=`9px ${m}`,r.fillStyle="white",r.fillText(d[0],c,u+3))}}(t,r)}(a))}})})}},8621:function(e,t,r){r.d(t,{HT:function(){return d},yL:function(){return y},vm:function(){return w}});var n=r(7437),l=r(4012),i=r(3887),a=r(1410),o=r(6661),s=r(7704),u=r(3167),c=r(2265);function d({setTracks:e,config:t,song:r}){let l=t.tracks,i=(t,r)=>{e({...l,[t]:r})};return(0,n.jsx)(n.Fragment,{children:Object.entries(l).map(([e,t])=>(0,n.jsx)(f,{track:t,trackId:+e,setTrack:i,noteCount:(null==r?void 0:r.notes.filter(t=>t.track===+e).length)??0},e))})}function f({track:e,trackId:t,setTrack:r,noteCount:l}){let[a,o]=(0,c.useState)({error:!1,loading:!1}),s=(0,i.nn)();return(0,n.jsxs)("span",{className:"m-4 flex-grow rounded-md border border-black bg-white px-3 sm:flex-grow-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center",children:[(0,n.jsxs)("span",{style:{},children:["Track ",t+1,e.track.name?": "+e.track.name:""]}),(0,n.jsx)("span",{className:"mx-1 my-2 h-6 w-[2px] bg-purple-light"}),(0,n.jsxs)("span",{children:[l," Notes"]})]}),(0,n.jsx)(p,{value:e.instrument,onSelect:n=>{o({error:!1,loading:!0}),s.setTrackInstrument(t,n).then(()=>{o({error:!1,loading:!1}),r(t,{...e,instrument:n})}).catch(()=>{o({error:!0,loading:!1})})},error:a.error,loading:a.loading}),(0,n.jsx)(h,{hand:e.hand,sound:e.sound,onSelectHand:n=>{e.hand===n&&(n="none"),r(t,{...e,hand:n})},onToggleSound:n=>{s.setTrackVolume(t,n?1:0),r(t,{...e,sound:n})}})]})}function p({value:e,error:t,loading:r,onSelect:i}){return(0,n.jsx)(l.Ph,{error:t,loading:r,value:e,onChange:i,options:a.qu,format:s.Jp,display:s.Jp})}function h({hand:e,sound:t,onSelectHand:r,onToggleSound:l}){return(0,n.jsxs)("div",{className:"jusitfy-around flex items-center gap-4 p-4",children:[(0,n.jsx)(m,{on:"left"===e,onClick:()=>{r("left")}}),(0,n.jsx)(g,{on:"right"===e,onClick:()=>{r("right")}}),(0,n.jsx)(v,{on:t,onClick:e=>{e.stopPropagation(),l(!t)}})]})}let x={fontSize:"14px",paddingTop:"8px"};function m({on:e,onClick:t}){return(0,n.jsxs)("button",{className:"flex flex-col items-center",children:[(0,n.jsx)(o.obs,{height:32,width:32,fill:(0,u.Z)(e?"fill-purple-primary":"fill-white hover:fill-purple-hover"),onClick:t}),(0,n.jsx)("span",{style:x,children:"Left Hand"})]})}function g({on:e,onClick:t}){return(0,n.jsxs)("button",{className:"flex flex-col items-center",children:[(0,n.jsx)(o.ayv,{height:32,width:32,fill:(0,u.Z)(e?"fill-purple-primary":"fill-white hover:fill-purple-hover"),onClick:t}),(0,n.jsx)("span",{style:x,children:"Right Hand"})]})}function v({on:e,onClick:t}){let r=e?o.CM7:o.aDH;return(0,n.jsxs)("button",{className:"flex flex-col items-center",children:[(0,n.jsx)(r,{height:32,width:32,className:(0,u.Z)("transition",e&&"text-purple-primary"),onClick:t}),(0,n.jsx)("span",{style:x,children:e?"Sound On":"Sound Off"})]})}var b=r(7945),k=r(8757);let j={capture:!0};function y({height:e,setRange:t=()=>{},onSeek:r=()=>{},onClick:l=()=>{},rangeSelection:a}){let[o,d]=(0,c.useState)(!1),f=(0,c.useRef)(null),p=(0,c.useRef)(null),{width:h,measureRef:x}=(0,b.tH)(),m=(0,c.useRef)(null),g=(0,c.useRef)(null),v=(0,c.useRef)(null),y=(0,c.useRef)(null),w=(0,c.useRef)(null),N=(0,c.useRef)(0),S=(0,i.nn)(),R=(0,c.useRef)(!1),C=(0,c.useRef)(!1),P=(0,k.Dv)(S.song),T=(0,c.useRef)(),D=(0,c.useRef)(),U=(0,c.useRef)(!1),E=(0,c.useCallback)(e=>(0,s.uZ)((e.clientX-N.current)/h,{min:0,max:1}),[h]);(0,b.On)(()=>{if(!f.current)return;let e=S.getTime()/S.getDuration();if(f.current.style.transform=`translateX(${e*h}px)`,m.current){let e=S.getRealTimeDuration(0,S.getTime());m.current.innerText=String((0,s.mr)(e))}if(w.current&&a){let e=a.start,t=a.end;t<e&&([e,t]=[t,e],R.current=!R.current,C.current=!C.current),w.current.style.left=N.current+e/S.getDuration()*h+"px",w.current.style.width=(t-e)/S.getDuration()*h+"px"}}),(0,c.useEffect)(()=>{p.current&&(N.current=p.current.getBoundingClientRect().x)},[h]);let O=(0,c.useCallback)(e=>{let t=E(e)*S.getDuration();r(),S.seek(t)},[S,E,r]);return(0,b.OR)("pointerdown",e=>{var t;let r=e.target;(null===(t=T.current)||void 0===t?void 0:t.contains(r))&&!R.current&&!C.current&&(U.current=!0,O(e))}),(0,b.OR)("click",e=>{var t;let r=e.target,n=R.current||C.current||U.current,l=null===(t=D.current)||void 0===t?void 0:t.contains(r);(n||l)&&e.stopPropagation(),R.current=!1,C.current=!1,U.current=!1},void 0,j),(0,b.OR)("pointermove",e=>{let r=E(e)*S.getDuration();(R.current||C.current)&&a?(R.current?a.start=r:a.end=r,t(a)):U.current&&O(e)}),(0,n.jsxs)("div",{className:"relative flex w-full select-none border-b border-b-black bg-gray-300",onClick:l,style:{height:e},ref:D,onPointerMove:e=>{if(!S.getSong()||!v.current||!g.current||!y.current)return;let t=E(e)*S.getDuration(),r=S.getMeasureForTime(t);y.current.style.left=`${(0,s.uZ)(e.clientX-N.current-24,{min:0,max:h-90})}px`,v.current.innerText=String(null==r?void 0:r.number),g.current.innerText=(0,s.mr)(S.getRealTimeDuration(0,t))},children:[(0,n.jsxs)("div",{className:(0,u.Z)(o?"flex":"hidden","absolute z-30 min-w-max items-center justify-between gap-8","-top-1 rounded-lg bg-black/90 px-4 py-2","-translate-y-full"),ref:y,children:[(0,n.jsxs)("span",{className:"text-gray-300",children:["Time: ",(0,n.jsx)("span",{className:"text-sm text-purple-hover",ref:g})]}),(0,n.jsxs)("span",{className:"text-gray-300",children:["Measure: ",(0,n.jsx)("span",{className:"text-sm text-purple-hover",ref:v})]})]}),(0,n.jsx)("span",{ref:m,className:"min-w-[80px] self-center px-4 py-2 text-black"}),(0,n.jsxs)("div",{ref:T,className:"relative h-4 flex-grow self-center overflow-hidden rounded-full",onPointerOver:()=>d(!0),onPointerOut:()=>d(!1),children:[(0,n.jsx)("div",{ref:p,className:"absolute"}),(0,n.jsx)("div",{ref:x,className:"absolute h-full w-full bg-gray-400"}),(0,n.jsx)("div",{ref:f,className:"pointer-events-none absolute h-full w-full bg-purple-primary",style:{left:-h}})]}),(0,n.jsx)("span",{className:"min-w-[80px] self-center px-4 py-2 text-black",children:P?(0,s.mr)(S.getRealTimeDuration(0,P.duration)):"00:00"}),a&&(0,n.jsxs)("div",{ref:w,className:"pointer-events-none absolute flex h-full items-center",children:[(0,n.jsx)("div",{className:"absolute h-4 w-[calc(100%-10px)] bg-purple-dark/40"}),(0,n.jsx)("div",{className:"pointer-events-auto absolute left-0 h-6 w-6 -translate-x-1/2 cursor-pointer rounded-full bg-purple-dark/90 transition hover:bg-purple-hover/90",onPointerEnter:()=>d(!0),onPointerLeave:()=>d(!1),onPointerDown:()=>R.current=!0}),(0,n.jsx)("div",{className:"pointer-events-auto absolute right-0 h-6 w-6 translate-x-1/2 cursor-pointer rounded-full bg-purple-dark/90 transition hover:bg-purple-hover/90",onPointerDown:()=>C.current=!0,onPointerEnter:()=>d(!0),onPointerLeave:()=>d(!1)})]})]})}function w(){let e=(0,i.nn)(),t=(0,k.Dv)(e.volume),r=0===t;return(0,n.jsx)(l.Lt,{target:(0,n.jsx)("div",{className:"text-white",onClick:()=>r?e.setVolume(1):e.setVolume(0),children:r?(0,n.jsx)(o.aDH,{size:24}):(0,n.jsx)(o.CM7,{size:24})}),openOn:"hover",children:(0,n.jsxs)("div",{className:"relative z-20 flex h-44 w-8 flex-col items-center bg-white p-2",children:[(0,n.jsx)(l.iR,{orientation:"vertical",min:0,max:1,step:.01,value:[t],onValueChange:t=>e.setVolume(t[0]),onClick:e=>e.stopPropagation()}),(0,n.jsx)("span",{className:"text-center text-sm text-black",children:Math.round(100*t)})]})})}}}]);