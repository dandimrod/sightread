(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[992],{8011:function(e,t,i){Promise.resolve().then(i.bind(i,5794))},5794:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return C}});var n=i(7437),s=i(5963),r=i(6094),a=i(7397),l=i(1410),o=i(7945),c=i(2265),d=i(4012),u=i(8621),h=i(3887),m=i(7503),f=i(1241),x=i(6661),p=i(8620).Buffer;function g({show:e=!0,onClose:t=()=>{},songMeta:i}){let{id:s,source:r}=i??{},a=(0,h.nn)(),l=(0,o.FI)();return((0,o.OR)("keydown",t=>{e&&" "===t.key&&t.preventDefault()}),e&&s&&r)?(0,n.jsx)(d.u_,{show:e&&!!s,onClose:function(){return a.stop(),t()},className:"min-w-[min(100%,600px)]",children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 p-8",children:[(0,n.jsx)("div",{className:"flex w-full flex-col whitespace-nowrap",children:(0,n.jsx)("span",{className:"text-2xl font-semibold",children:"Preview your recording"})}),(0,n.jsxs)("div",{className:"flex flex-grow flex-col overflow-hidden rounded-md",children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"pointer-events-none absolute z-20 h-full w-full rounded-md"}),(0,n.jsx)(u.yL,{height:30})]}),(0,n.jsxs)("div",{style:{position:"relative",backgroundColor:"#2e2e2e",height:340,minHeight:340,width:"100%",overflow:"hidden"},onClick:()=>a.toggle,children:[(0,n.jsx)(m.Z,{isLoading:!l.canPlay,isPlaying:l.playing,onPlay:e=>{e.stopPropagation(),a.play()}}),s&&r&&(0,n.jsx)(f.F,{songId:s,source:r})]}),(0,n.jsx)(d.ne,{height:16}),(0,n.jsxs)("div",{className:"flex w-full gap-4",children:[(0,n.jsxs)("button",{className:"flex h-10 w-full cursor-pointer items-center justify-center gap-2 rounded-md border border-purple-primary bg-white px-1 text-xl text-black transition hover:bg-purple-primary hover:text-white",onClick:()=>{var e,t;let i=window.location.origin;e=`${i}/play/?source=base64&id=${s}`,null===(t=navigator.clipboard)||void 0===t||t.writeText(e)},children:[(0,n.jsx)(x.mBz,{}),"Copy Share URL"]}),(0,n.jsxs)("button",{className:"flex h-10 w-full cursor-pointer items-center justify-center gap-2 rounded-md border-none bg-purple-primary px-1 text-xl text-white transition hover:bg-purple-hover",onClick:()=>(function(e){let t=p.from(e,"base64"),i=new Blob([t],{type:"audio/midi"}),n=document.createElement("a");n.href=URL.createObjectURL(i),n.download="recording.mid",n.click()})(s),children:[(0,n.jsx)(x.UWx,{}),"Download MIDI"]})]})]})]})}):null}var b=i(5801),j=i(7704),v=i(8792);function y({isError:e,isLoading:t,isRecordingAudio:i,value:s,onChange:r,onClickMidi:a,onClickRecord:o}){return(0,n.jsxs)("div",{className:"flex h-[50px] min-h-[50px] w-full items-center gap-4 bg-[#292929] px-4 text-2xl text-white transition",children:[(0,n.jsx)(b.g,{tooltip:"Back",children:(0,n.jsx)(v.default,{href:"/",children:(0,n.jsx)(x.XdH,{size:24})})}),(0,n.jsx)(b.g,{tooltip:i?"Stop recording":"Start recording audio",className:"ml-auto",onClick:o,children:i?(0,n.jsx)(x.x9i,{size:24}):(0,n.jsx)(x.UOZ,{size:24})}),(0,n.jsx)(b.g,{tooltip:"Choose a MIDI device",onClick:a,children:(0,n.jsx)(x.mbR,{size:24})}),(0,n.jsx)(d.Ph,{className:"h-3/4 max-w-fit text-base text-black",loading:t,error:e,value:s,onChange:r,options:l.qu,format:j.Jp,display:j.Jp})]})}class w{constructor(){this.time=0,this.lastTime=0,this.time=Number.MAX_SAFE_INTEGER,this.lastTime=0,this.active=new Map,this.song={bpms:[],tracks:{1:{instrument:"piano"}},measures:[],notes:[],duration:0,items:[],keySignature:"C"},this.song.items=this.song.notes,(0,j.jU)()&&this.loop()}start(){this.time=Number.MAX_SAFE_INTEGER,this.lastTime=Date.now(),this.active.clear(),this.loop()}stop(){"number"==typeof this.raf&&cancelAnimationFrame(this.raf)}loop(){this.raf=requestAnimationFrame(()=>{let e=Date.now(),t=e-this.lastTime;for(let[i,n]of(this.time-=t,this.lastTime=e,this.active.entries())){let e=this.song.notes.find(e=>e.midiNote===i);e&&(e.time=this.getTime(),e.duration=n-e.time)}this.loop()})}addNote(e,t=80){let i=this.getTime();this.song.notes.unshift({midiNote:e,velocity:t,type:"note",track:1,time:i,duration:0,measure:0}),this.active.set(e,i)}releaseNote(e){this.active.delete(e)}getTime(){return this.time/1e3}}var N=i(8620).Buffer;function C(){let[e,t]=(0,c.useState)("acoustic_grand_piano"),i=(0,l.ZN)(e),d=(0,o.UC)(()=>new w),[u,h]=(0,c.useState)(!1),{isRecording:m,startRecording:f,stopRecording:x}=(0,r.Z7)(r.ZP),[p,b]=(0,c.useState)(""),j=(0,c.useCallback)((e,t=80)=>{i.synth.playNote(e,t),d.addNote(e,t)},[d,i.synth]),v=(0,c.useCallback)(e=>{i.synth.stopNote(e),d.releaseNote(e)},[d,i.synth]);return(0,c.useEffect)(()=>{let e=e=>{"up"===e.type?v(e.note):j(e.note,e.velocity)};return r.ZP.subscribe(e),()=>{r.ZP.unsubscribe(e)}},[j,v]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex h-screen w-screen flex-col",children:[(0,n.jsx)(y,{onClickMidi:e=>{e.stopPropagation(),h(!u)},onClickRecord:e=>{if(e.stopPropagation(),m){let e=x();null!==e&&b(N.from(e).toString("base64"))}else f()},isRecordingAudio:m,isLoading:i.loading,isError:i.error,value:e,onChange:e=>t(e)}),(0,n.jsx)(s.C,{isOpen:u,onClose:()=>h(!1)}),(0,n.jsx)(g,{show:p.length>0,onClose:()=>b(""),songMeta:{source:"base64",id:p}}),(0,n.jsx)("div",{className:"relative flex-grow",children:(0,n.jsx)(a.LX,{song:d.song,config:{visualization:"falling-notes",noteLetter:!1},hand:"both",handSettings:{1:{hand:"right"}},getTime:()=>d.getTime(),constrictView:!1})})]})})}},5963:function(e,t,i){"use strict";i.d(t,{C:function(){return h}});var n=i(7437),s=i(4012),r=i(6094),a=i(5590),l=i(7945),o=i(6661),c=i(3167),d=i(8757),u=i(2265);function h(e){let{isOpen:t,onClose:i}=e,{inputs:h,refreshInput:f}=(0,l.fb)(),{outputs:x,refreshOutput:p}=(0,l.iT)(),[g,b]=(0,u.useState)(!1),[j,v]=(0,u.useState)(!1),y=()=>{f(),p()},w=(0,d.Dv)(a.G$);return(0,n.jsx)(s.u_,{show:t,onClose:i,children:(0,n.jsxs)("div",{className:"relative flex w-[min(100vw,500px)] flex-col p-8 text-base",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"Connect Your Piano"}),(0,n.jsx)(s.ne,{height:32}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("h1",{className:"text-lg font-medium",children:"Input devices"}),(0,n.jsx)("button",{style:{animationIterationCount:.5},className:(0,c.Z)("hover:text-purple-hover",g&&"animate-spin"),onClick:()=>{y(),b(!0)},onAnimationEnd:()=>{b(!1)},children:(0,n.jsx)(o.oQ9,{})})]}),(0,n.jsx)(s.ne,{height:8}),(0,n.jsxs)("div",{className:"flex min-h-[200px] flex-col gap-1 rounded-md bg-gray-100",children:[!(null==h?void 0:h.size)&&(0,n.jsx)("span",{className:"p-5 text-gray-900",children:"No devices found. Please connect a MIDI device and hit refresh."}),h&&Array.from(h.values()).map(e=>{let t=(0,r.tb)(e);return(0,n.jsxs)("div",{className:"flex h-12 items-center justify-between p-4 odd:bg-gray-200",children:[e.name,(0,n.jsx)(m,{enabled:t,onClick:async()=>{t?(0,r.Gr)(e):(0,r.eP)(e),y()}})]},e.id)})]}),(0,n.jsx)(s.ne,{height:32}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("h1",{className:"text-lg font-medium",children:"Output devices"}),(0,n.jsx)("button",{style:{animationIterationCount:.5},className:(0,c.Z)("hover:text-purple-hover",j&&"animate-spin"),onClick:()=>{y(),v(!0)},onAnimationEnd:()=>{v(!1)},children:(0,n.jsx)(o.oQ9,{})})]}),(0,n.jsx)(s.ne,{height:8}),(0,n.jsxs)("div",{className:"flex min-h-[200px] flex-col gap-1 rounded-md bg-gray-100",children:[x&&(0,n.jsxs)("div",{className:"flex h-12 items-center justify-between p-4 odd:bg-gray-200",children:["This Device",(0,n.jsx)(m,{enabled:w,onClick:async()=>{w?(0,a.ay)():(0,a.yM)(),y()}})]},"local"),x&&Array.from(x.values()).map(e=>{let t=(0,r.kY)(e);return(0,n.jsxs)("div",{className:"flex h-12 items-center justify-between p-4 odd:bg-gray-200",children:[e.name,(0,n.jsx)(m,{enabled:t,onClick:async()=>{t?(0,r.I7)(e):(0,r.AZ)(e),y()}})]},e.id)})]})]})})}function m({enabled:e,...t}){return(0,n.jsx)("button",{className:(0,c.Z)("rounded-xl border border-purple-primary px-2 py-1 transition hover:bg-purple-hover",e&&"bg-purple-primary text-white"),...t,children:e?"Disable":"Enable"})}},5801:function(e,t,i){"use strict";i.d(t,{g:function(){return u},Z:function(){return d}});var n=i(7437),s=i(4012),r=i(8621),a=i(6661),l=i(7704),o=i(3167);function c({isPlaying:e,onTogglePlaying:t,isLoading:i}){return e?(0,n.jsx)(u,{tooltip:"Pause",onClick:t,children:(0,n.jsx)(a.dzL,{size:24})}):i?(0,n.jsx)(a.aNw,{width:24,height:24,className:"m-0 animate-spin p-0 text-white"}):(0,n.jsx)(u,{tooltip:"Play",onClick:t,children:(0,n.jsx)(a.shV,{size:24})})}function d({isPlaying:e,isLoading:t,onTogglePlaying:i,onClickSettings:s,onClickBack:d,onClickRestart:h,settingsOpen:m,title:f,onClickMidi:x}){return(0,n.jsxs)("div",{className:"align-center relative z-10 flex h-[50px] min-h-[50px] w-screen justify-center gap-8 bg-[#292929] px-1",children:[(0,n.jsx)(u,{tooltip:"Back",className:"!absolute left-3 top-1/2 -translate-y-1/2",style:{transform:"translateY(-50%)"},children:(0,n.jsx)(a.XdH,{size:24,onClick:d})}),(0,n.jsxs)("div",{className:(0,o.Z)("flex h-full items-center gap-8","sm:absolute sm:left-1/2 sm:-translate-x-3/4"),children:[(0,n.jsx)(u,{tooltip:"Restart",children:(0,n.jsx)(a.km5,{size:24,onClick:h})}),(0,n.jsx)(c,{isPlaying:e,isLoading:t,onTogglePlaying:i})]}),(0,n.jsx)("div",{className:"hidden h-full items-center text-white sm:ml-auto sm:flex",children:f}),(0,n.jsxs)("div",{className:"mr-[20px] flex h-full items-center gap-8",children:[(0,n.jsx)(u,{tooltip:"Choose a MIDI device",children:(0,n.jsx)(a.mbR,{size:24,onClick:x})}),(0,n.jsx)(u,{tooltip:"Settings",isActive:m,children:(0,n.jsx)(a.Zrf,{size:24,onClick:s})}),!(0,l.tq)()&&(0,n.jsx)(r.vm,{})]})]})}function u({tooltip:e,children:t,isActive:i,className:r,...a}){return(0,n.jsx)(s.u,{label:e,children:(0,n.jsx)("button",{...a,className:(0,o.Z)(r,i?"fill-purple-primary text-purple-primary":"fill-white text-white","hover:fill-purple-hover hover:text-purple-hover"),children:t})})}i(2265)},7503:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var n=i(7437),s=i(6661),r=i(3167);function a({isPlaying:e,isLoading:t,onPlay:i}){if(e)return null;let a=t?(0,n.jsx)(s.aNw,{width:60,height:60,className:"animate-spin text-white"}):(0,n.jsx)("div",{className:(0,r.Z)("cursor-pointer text-purple-primary hover:text-purple-hover","grid h-16 w-16 place-items-center rounded-full bg-white"),onClick:i,children:(0,n.jsx)(s.shV,{height:36,width:36,className:"relative left-1"})});return(0,n.jsx)("div",{className:"absolute z-10 grid h-full w-full place-items-center bg-gray-700/70",onClick:e=>e.stopPropagation(),children:a})}},1241:function(e,t,i){"use strict";i.d(t,{F:function(){return c}});var n=i(7437),s=i(4620),r=i(3887),a=i(7397),l=i(2265),o=i(869);function c({songId:e,source:t}){let{data:i,error:c}=(0,s.h)(e,t),d=(0,r.nn)();(0,l.useEffect)(()=>{i&&d.setSong(i,(0,o.q3)(i))},[i,d]);let u=(0,o.q3)(i,!0);return(0,n.jsx)(a.LX,{song:i,config:u,getTime:()=>d.getTime(),hand:"both",handSettings:(0,a.pA)(u)})}},4620:function(e,t,i){"use strict";i.d(t,{h:function(){return d}});var n=i(4551),s=i(9866),r=i(8016),a=i(8620).Buffer;let l=i(915),o=new Map(l.map(e=>[e.id,e]));function c(e){return e.arrayBuffer().then(n.xz)}function d(e,t){return(0,r.ZP)([e,t],([e,t])=>(function(e,t){switch(t){case"midishare":case"builtin":let i=function(e,t){var i;if("midishare"===t)return`https://assets.midishare.dev/scores/${e}/${e}.mid`;let n=null===(i=o.get(e))||void 0===i?void 0:i.file;if(!n)throw Error("Song "+e+" not found");return"/"+n}(e,t);return fetch(i).then(c);case"base64":return Promise.resolve(function(e){let t=a.from(decodeURIComponent(e),"base64");return(0,n.xz)(t.buffer)}(e));case"upload":return Promise.resolve((0,s.Zr)(e)).then(e=>null===e?Promise.reject(Error("Could not find song")):e);case"url":return fetch(e).then(c);default:return Promise.reject(Error(`Could not get song for ${e}, ${t}`))}})(e,t))}},915:function(e){"use strict";e.exports=JSON.parse('[{"file":"music/songs/Prelude I in C Major.mid","title":"Prelude I in C Major","artist":"Bach","source":"builtin","id":"fa7a5d0bf5012a4cb4a19f1de2e58b10","duration":119.14015151515304},{"file":"music/songs/Ode to Joy.mid","title":"Ode to Joy","artist":"Friedrich Schiller","source":"builtin","id":"8d4441d47b332772da481c529bd38e24","duration":33.850000000000016},{"file":"music/songs/Canon in D.mid","title":"Canon in D","artist":"Pachelbel","source":"builtin","id":"7641a769d0e9ec9c95b2b967f2ad2cf3","duration":127.08000000000034},{"file":"music/songs/Twinkle Twinkle Little Star.mid","title":"Twinkle Twinkle Little Star","artist":"Jane Taylor","source":"builtin","id":"b3fa743cca3ba0c6e0a9aa4f2a51092b","duration":23.95},{"file":"music/songs/Soon May The Wellerman Come.mid","title":"Soon May The Wellerman Come","source":"builtin","id":"eb574301c4eb30ad4d6a4dd57d091509","duration":119.9711538461538},{"file":"music/songs/The Star Spangled Banner.mid","title":"The Star Spangled Banner","artist":"John Smith","source":"builtin","id":"bb4edb91d3a12b8c745e59b8435f74c2","duration":64.45735294117637},{"file":"music/songs/Mexican Hat Dance.mid","title":"Mexican Hat Dance","artist":"Jesus Rubio","source":"builtin","id":"b50ee876b785c66a70dba3159d21e81e","duration":41.33263888888888},{"file":"music/songs/Comin Round The Mountain.mid","title":"Comin Round The Mountain","artist":"Sandberg and Wallace","source":"builtin","id":"4aaf49c8b4c28a7cea7433d54de2fcc9","duration":34.88181818181824},{"file":"music/songs/Blue Danube.mid","title":"Blue Danube","artist":"Johan Strauss","source":"builtin","id":"9b78807499154198f17eb7c8bff91879","duration":379.92857142857196},{"file":"music/songs/La Cucaracha.mid","title":"La Cucaracha","source":"builtin","id":"ba3bed184b79d04a48a19913ff29d6da","duration":47}]')}},function(e){e.O(0,[512,656,831,887,269,582,58,971,69,744],function(){return e(e.s=8011)}),_N_E=e.O()}]);