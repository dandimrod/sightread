(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9802:function(e,n,s){Promise.resolve().then(s.bind(s,3850))},5963:function(e,n,s){"use strict";s.d(n,{C:function(){return f}});var t=s(7437),i=s(4012),l=s(6094),a=s(5590),r=s(7945),c=s(6661),o=s(3167),d=s(8757),u=s(2265);function f(e){let{isOpen:n,onClose:s}=e,{inputs:f,refreshInput:h}=(0,r.fb)(),{outputs:m,refreshOutput:g}=(0,r.iT)(),[p,j]=(0,u.useState)(!1),[v,b]=(0,u.useState)(!1),N=()=>{h(),g()},y=(0,d.Dv)(a.G$);return(0,t.jsx)(i.u_,{show:n,onClose:s,children:(0,t.jsxs)("div",{className:"relative flex w-[min(100vw,500px)] flex-col p-8 text-base",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Connect Your Piano"}),(0,t.jsx)(i.ne,{height:32}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("h1",{className:"text-lg font-medium",children:"Input devices"}),(0,t.jsx)("button",{style:{animationIterationCount:.5},className:(0,o.Z)("hover:text-purple-hover",p&&"animate-spin"),onClick:()=>{N(),j(!0)},onAnimationEnd:()=>{j(!1)},children:(0,t.jsx)(c.oQ9,{})})]}),(0,t.jsx)(i.ne,{height:8}),(0,t.jsxs)("div",{className:"flex min-h-[200px] flex-col gap-1 rounded-md bg-gray-100",children:[!(null==f?void 0:f.size)&&(0,t.jsx)("span",{className:"p-5 text-gray-900",children:"No devices found. Please connect a MIDI device and hit refresh."}),f&&Array.from(f.values()).map(e=>{let n=(0,l.tb)(e);return(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between p-4 odd:bg-gray-200",children:[e.name,(0,t.jsx)(x,{enabled:n,onClick:async()=>{n?(0,l.Gr)(e):(0,l.eP)(e),N()}})]},e.id)})]}),(0,t.jsx)(i.ne,{height:32}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("h1",{className:"text-lg font-medium",children:"Output devices"}),(0,t.jsx)("button",{style:{animationIterationCount:.5},className:(0,o.Z)("hover:text-purple-hover",v&&"animate-spin"),onClick:()=>{N(),b(!0)},onAnimationEnd:()=>{b(!1)},children:(0,t.jsx)(c.oQ9,{})})]}),(0,t.jsx)(i.ne,{height:8}),(0,t.jsxs)("div",{className:"flex min-h-[200px] flex-col gap-1 rounded-md bg-gray-100",children:[m&&(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between p-4 odd:bg-gray-200",children:["This Device",(0,t.jsx)(x,{enabled:y,onClick:async()=>{y?(0,a.ay)():(0,a.yM)(),N()}})]},"local"),m&&Array.from(m.values()).map(e=>{let n=(0,l.kY)(e);return(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between p-4 odd:bg-gray-200",children:[e.name,(0,t.jsx)(x,{enabled:n,onClick:async()=>{n?(0,l.I7)(e):(0,l.AZ)(e),N()}})]},e.id)})]})]})})}function x({enabled:e,...n}){return(0,t.jsx)("button",{className:(0,o.Z)("rounded-xl border border-purple-primary px-2 py-1 transition hover:bg-purple-hover",e&&"bg-purple-primary text-white"),...n,children:e?"Disable":"Enable"})}},5801:function(e,n,s){"use strict";s.d(n,{g:function(){return u},Z:function(){return d}});var t=s(7437),i=s(4012),l=s(8621),a=s(6661),r=s(7704),c=s(3167);function o({isPlaying:e,onTogglePlaying:n,isLoading:s}){return e?(0,t.jsx)(u,{tooltip:"Pause",onClick:n,children:(0,t.jsx)(a.dzL,{size:24})}):s?(0,t.jsx)(a.aNw,{width:24,height:24,className:"m-0 animate-spin p-0 text-white"}):(0,t.jsx)(u,{tooltip:"Play",onClick:n,children:(0,t.jsx)(a.shV,{size:24})})}function d({isPlaying:e,isLoading:n,onTogglePlaying:s,onClickSettings:i,onClickBack:d,onClickRestart:f,settingsOpen:x,title:h,onClickMidi:m}){return(0,t.jsxs)("div",{className:"align-center relative z-10 flex h-[50px] min-h-[50px] w-screen justify-center gap-8 bg-[#292929] px-1",children:[(0,t.jsx)(u,{tooltip:"Back",className:"!absolute left-3 top-1/2 -translate-y-1/2",style:{transform:"translateY(-50%)"},children:(0,t.jsx)(a.XdH,{size:24,onClick:d})}),(0,t.jsxs)("div",{className:(0,c.Z)("flex h-full items-center gap-8","sm:absolute sm:left-1/2 sm:-translate-x-3/4"),children:[(0,t.jsx)(u,{tooltip:"Restart",children:(0,t.jsx)(a.km5,{size:24,onClick:f})}),(0,t.jsx)(o,{isPlaying:e,isLoading:n,onTogglePlaying:s})]}),(0,t.jsx)("div",{className:"hidden h-full items-center text-white sm:ml-auto sm:flex",children:h}),(0,t.jsxs)("div",{className:"mr-[20px] flex h-full items-center gap-8",children:[(0,t.jsx)(u,{tooltip:"Choose a MIDI device",children:(0,t.jsx)(a.mbR,{size:24,onClick:m})}),(0,t.jsx)(u,{tooltip:"Settings",isActive:x,children:(0,t.jsx)(a.Zrf,{size:24,onClick:i})}),!(0,r.tq)()&&(0,t.jsx)(l.vm,{})]})]})}function u({tooltip:e,children:n,isActive:s,className:l,...a}){return(0,t.jsx)(i.u,{label:e,children:(0,t.jsx)("button",{...a,className:(0,c.Z)(l,s?"fill-purple-primary text-purple-primary":"fill-white text-white","hover:fill-purple-hover hover:text-purple-hover"),children:n})})}s(2265)},3850:function(e,n,s){"use strict";s.r(n),s.d(n,{default:function(){return P}});var t=s(7437),i=s(8621),l=s(4620),a=s(1752),r=s(6094),c=s(3887),o=s(7397),d=s(1410),u=s(7945),f=s(3167),x=s(8757),h=s(7907),m=s(2265),g=s(5801),p=s(4012),j=s(3578),v=s(6661),b=s(7704);function N(){let e=(0,c.nn)(),n=(0,x.Dv)(e.getBpm()),s=(0,x.Dv)(e.getBpmModifier()),i=(0,b.NM)(n)+" BPM",l=(0,b.NM)(100*s)+"%";return(0,t.jsxs)("div",{className:"mx-auto flex gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"self-center text-center text-xl",children:l}),(0,t.jsx)("span",{className:"text-center text-sm",children:i})]}),(0,t.jsxs)("div",{className:"flex flex-col justify-between",children:[(0,t.jsx)(v.Kh3,{size:24,className:"text-black hover:cursor-pointer hover:text-purple-hover",onClick:e.increaseBpm.bind(e)}),(0,t.jsx)(v._ME,{size:24,className:"text-black hover:cursor-pointer hover:text-purple-hover",onClick:e.decreaseBpm.bind(e)})]})]})}var y=s(9866);function w(e){var n;let{left:s,right:l,visualization:a,waiting:r,noteLetter:c,coloredNotes:o,keySignature:d}=e.config,{onClose:f,onLoopToggled:x,isLooping:h}=e,[g,v]=(0,m.useState)(!1),b=(0,m.useRef)(null),w=(0,m.useCallback)(()=>null==f?void 0:f(),[f]);(0,u.Bj)(w,b),(0,u.OR)("keydown",e=>{"Escape"===e.key&&(null==f||f())});let k=n=>{"left"===n&&e.onChange({...e.config,left:!e.config.left}),"right"===n&&e.onChange({...e.config,right:!e.config.right})},S=n=>{e.onChange({...e.config,visualization:n})};return(0,t.jsxs)("div",{className:"relative flex max-h-[calc(100vh-300px)] w-full flex-col gap-4 overflow-auto bg-gray-100 p-4 sm:flex-row",ref:b,children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("h3",{className:"text-center text-2xl text-purple-primary",children:"Settings"}),(0,t.jsx)("div",{className:"flex-grow"}),(0,t.jsx)("button",{className:"bg-purple-primary text-white hover:bg-purple-hover rounded-md px-4 py-2",onClick:()=>void(0,y.qA)(e.config),children:"Save as default"})]}),(0,t.jsxs)("div",{className:"flex flex-grow flex-col flex-wrap items-center gap-4 whitespace-nowrap sm:flex-row sm:items-stretch",children:[(0,t.jsx)(C,{title:"Speed",className:"flex flex-grow",children:(0,t.jsx)(N,{})}),(0,t.jsxs)(C,{title:"Hands",className:"flex flex-grow flex-col",children:[(0,t.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,t.jsx)("span",{className:"w-10",children:"Left"}),(0,t.jsx)(p.ZD,{className:"self-center",checked:s,onChange:()=>k("left")})]}),(0,t.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,t.jsx)("span",{className:"w-10",children:"Right"}),(0,t.jsx)(p.ZD,{checked:l,onChange:()=>k("right")})]})]}),(0,t.jsxs)(C,{title:"Visualization",className:"flex-grow",children:[(0,t.jsxs)("button",{className:"flex items-center justify-center gap-1",onClick:()=>S("falling-notes"),children:[(0,t.jsx)("input",{type:"radio",className:"w-5",checked:"falling-notes"===a,readOnly:!0}),(0,t.jsx)("span",{className:"block w-[120px] text-left",children:"Falling notes"})]}),(0,t.jsxs)("button",{className:"flex items-center justify-center gap-1",onClick:()=>S("sheet"),children:[(0,t.jsx)("input",{className:"w-5",type:"radio",checked:"sheet"===a,readOnly:!0}),(0,t.jsx)("span",{className:"block w-[120px] text-left",children:" Sheet hero (beta)"})]})]}),(0,t.jsxs)("div",{className:"flex flex-grow flex-col gap-4 sm:flex-row",children:[(0,t.jsxs)(C,{title:"Additional settings",className:"flex-grow justify-center",children:[(0,t.jsxs)("div",{className:"flex justify-center",children:[(0,t.jsx)("span",{className:"min-w-[15ch]",children:"Wait mode"}),(0,t.jsx)(p.ZD,{className:"",checked:r,onChange:function(n){e.onChange({...e.config,waiting:n})}})]}),(0,t.jsxs)("div",{className:"flex justify-center",children:[(0,t.jsx)("span",{className:"min-w-[15ch]",children:"Display note letter"}),(0,t.jsx)(p.ZD,{checked:c,onChange:function(){e.onChange({...e.config,noteLetter:!c})}})]}),(0,t.jsxs)("div",{className:"flex justify-center",children:[(0,t.jsx)("span",{className:"min-w-[15ch]",children:"Colored notes"}),(0,t.jsx)(p.ZD,{checked:o,onChange:function(){e.onChange({...e.config,coloredNotes:!o})}})]}),(0,t.jsxs)("div",{className:"flex justify-center",children:[(0,t.jsx)("span",{className:"min-w-[15ch]",children:"Key signature"}),(0,t.jsx)("select",{name:"keySignature",className:"w-[50px] border",value:d??(null===(n=e.song)||void 0===n?void 0:n.keySignature),onChange:n=>{var s;return s=n.target.value,void e.onChange({...e.config,keySignature:s})},children:(0,j.xG)().map(n=>{var s;return(0,t.jsxs)("option",{value:n,children:[n," ",n===(null===(s=e.song)||void 0===s?void 0:s.keySignature)?"(Default)":""]},`id-${n}`)})})]})]}),(0,t.jsxs)("div",{className:"flex flex-grow flex-col justify-between gap-4",children:[(0,t.jsx)(C,{title:"Practice loop",children:(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(p.ZD,{checked:h,onChange:x})})}),(0,t.jsx)(C,{title:"Track configuration",onClick:()=>v(e=>!e),className:"cursor-pointer hover:bg-purple-light"})]})]}),g&&(0,t.jsx)("div",{className:"flex max-w-[70vw] basis-full flex-wrap justify-center",children:(0,t.jsx)(i.HT,{config:e.config,setTracks:n=>{e.onChange({...e.config,tracks:n})},song:e.song})})]})]})}function C({children:e,title:n,className:s,onClick:i}){return(0,t.jsxs)("article",{className:(0,f.Z)(s,"flex min-w-[70vw] max-w-[70vw] flex-col gap-4 rounded-md bg-gray-200 p-4 sm:min-w-0"),onClick:i,children:[(0,t.jsx)("h3",{className:"text-center text-base font-semibold",children:n}),e]})}var k=s(5963);function S(){let e=(0,h.useRouter)(),n=(0,c.nn)(),{source:s,id:p,recording:j}=Object.fromEntries((0,h.useSearchParams)()),[v,b]=(0,m.useState)(!1),[N,y]=(0,m.useState)(!1),C=(0,u.FI)(),S=(0,u.UC)(()=>(0,d.A2)("acoustic_grand_piano")),{data:P}=(0,l.h)(p,s),D=(0,a.Mj)(p,s),M=(0,x.Dv)(n.getRange()),T=(0,m.useMemo)(()=>M?{start:M[0],end:M[1]}:void 0,[M]),Z=!!M,[R,z]=(0,u.Ox)(p);(0,u.R7)();let E=R.left&&R.right?"both":R.left?"left":R.right?"right":"none",{waiting:O,left:B,right:L}=R;return(0,m.useEffect)(()=>{n.setWait(O),B&&L?n.setHand("both"):n.setHand(B?"left":"right")},[O,B,L,n]),(0,u.L8)(()=>n.stop()),(0,m.useEffect)(()=>{if(!P)return;let e=(0,o.pF)(p,P);z(e),n.setSong(P,e)},[P,z,p,n]),(0,u.OR)("keydown",e=>{"Space"===e.code?(e.preventDefault(),n.toggle()):"Comma"===e.code?n.seek(n.currentSongTime-.016):"Period"===e.code&&n.seek(n.currentSongTime+.016)}),(0,m.useEffect)(()=>{let e=({type:e,note:n})=>{"down"===e?S.playNote(n):S.stopNote(n)};return r.ZP.subscribe(e),function(){r.ZP.unsubscribe(e)}},[S,P,R]),s&&p||e.replace("/"),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:(0,f.Z)("fixed","max-w-screen flex h-screen max-h-screen flex-col"),children:[!j&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Z,{title:null==D?void 0:D.title,isLoading:!C.canPlay,isPlaying:C.playing,onTogglePlaying:()=>n.toggle(),onClickRestart:()=>n.stop(),onClickBack:()=>{n.stop(),e.push("/")},onClickMidi:e=>{e.stopPropagation(),y(!N)},onClickSettings:e=>{e.stopPropagation(),b(!v)},settingsOpen:v}),(0,t.jsx)(k.C,{isOpen:N,onClose:()=>y(!1)}),(0,t.jsx)("div",{className:(0,f.Z)(!v&&"hidden"),children:(0,t.jsx)(w,{onClose:()=>b(!1),onChange:z,config:R,song:P,onLoopToggled:e=>{if(e){let e=n.getDuration(),s=e/10;n.setRange({start:e/2-s,end:e/2+s})}else{n.setRange(void 0);return}},isLooping:Z})}),(0,t.jsx)("div",{className:"relative min-w-full",children:(0,t.jsx)(i.yL,{rangeSelection:T,setRange:e=>n.setRange(e),height:40})})]}),(0,t.jsx)("div",{className:(0,f.Z)("fixed -z-10 h-[100vh] w-screen","!h-[100dvh]","sheet"===R.visualization?"bg-white":"bg-[#2e2e2e]"),children:(0,t.jsx)(o.LX,{song:P,config:R,hand:E,handSettings:(0,o.pA)(R),selectedRange:T,getTime:()=>n.getTime(),enableTouchscroll:"falling-notes"===R.visualization})})]})})}function P(){return(0,t.jsx)(m.Suspense,{children:(0,t.jsx)(S,{})})}},4620:function(e,n,s){"use strict";s.d(n,{h:function(){return d}});var t=s(4551),i=s(9866),l=s(8016),a=s(8620).Buffer;let r=s(915),c=new Map(r.map(e=>[e.id,e]));function o(e){return e.arrayBuffer().then(t.xz)}function d(e,n){return(0,l.ZP)([e,n],([e,n])=>(function(e,n){switch(n){case"midishare":case"builtin":let s=function(e,n){var s;if("midishare"===n)return`https://assets.midishare.dev/scores/${e}/${e}.mid`;let t=null===(s=c.get(e))||void 0===s?void 0:s.file;if(!t)throw Error("Song "+e+" not found");return"/"+t}(e,n);return fetch(s).then(o);case"base64":return Promise.resolve(function(e){let n=a.from(decodeURIComponent(e),"base64");return(0,t.xz)(n.buffer)}(e));case"upload":return Promise.resolve((0,i.Zr)(e)).then(e=>null===e?Promise.reject(Error("Could not find song")):e);case"url":return fetch(e).then(o);default:return Promise.reject(Error(`Could not get song for ${e}, ${n}`))}})(e,n))}},1752:function(e,n,s){"use strict";s.d(n,{Cr:function(){return x},Mj:function(){return j},g3:function(){return h},v2:function(){return p}});var t=s(915),i=s(7704),l=s(7807),a=s(8757),r=s(2265),c=s(9866);let o=Object.values(t).map(e=>[(0,i.km)(e.id,e.source),e]);function d(){return Object.values((0,c.MW)()).map(e=>[(0,i.km)(e.id,e.source),e])}let u=(0,l.cn)(o),f=(0,l.cn)(d());function x(){let e=(0,a.b9)(f);return(0,r.useCallback)(()=>e(d()),[e])}let h=(0,l.cn)([]),m=(0,l.cn)(e=>{let n=e(u),s=e(f),t=e(h);return new Map([...n,...s,...t])}),g=(0,l.cn)(e=>Array.from(e(m).values()));function p(){let e=(0,a.Dv)(g),[n,s]=(0,r.useState)(!1),t=(0,r.useMemo)(()=>[],[]);return(0,r.useEffect)(()=>{s(!0)},[]),n?e:t}function j(e,n){let s=(0,i.km)(e,n);return(0,a.Dv)(m).get(s)}},915:function(e){"use strict";e.exports=JSON.parse('[{"file":"music/songs/Prelude I in C Major.mid","title":"Prelude I in C Major","artist":"Bach","source":"builtin","id":"fa7a5d0bf5012a4cb4a19f1de2e58b10","duration":119.14015151515304},{"file":"music/songs/Ode to Joy.mid","title":"Ode to Joy","artist":"Friedrich Schiller","source":"builtin","id":"8d4441d47b332772da481c529bd38e24","duration":33.850000000000016},{"file":"music/songs/Canon in D.mid","title":"Canon in D","artist":"Pachelbel","source":"builtin","id":"7641a769d0e9ec9c95b2b967f2ad2cf3","duration":127.08000000000034},{"file":"music/songs/Twinkle Twinkle Little Star.mid","title":"Twinkle Twinkle Little Star","artist":"Jane Taylor","source":"builtin","id":"b3fa743cca3ba0c6e0a9aa4f2a51092b","duration":23.95},{"file":"music/songs/Soon May The Wellerman Come.mid","title":"Soon May The Wellerman Come","source":"builtin","id":"eb574301c4eb30ad4d6a4dd57d091509","duration":119.9711538461538},{"file":"music/songs/The Star Spangled Banner.mid","title":"The Star Spangled Banner","artist":"John Smith","source":"builtin","id":"bb4edb91d3a12b8c745e59b8435f74c2","duration":64.45735294117637},{"file":"music/songs/Mexican Hat Dance.mid","title":"Mexican Hat Dance","artist":"Jesus Rubio","source":"builtin","id":"b50ee876b785c66a70dba3159d21e81e","duration":41.33263888888888},{"file":"music/songs/Comin Round The Mountain.mid","title":"Comin Round The Mountain","artist":"Sandberg and Wallace","source":"builtin","id":"4aaf49c8b4c28a7cea7433d54de2fcc9","duration":34.88181818181824},{"file":"music/songs/Blue Danube.mid","title":"Blue Danube","artist":"Johan Strauss","source":"builtin","id":"9b78807499154198f17eb7c8bff91879","duration":379.92857142857196},{"file":"music/songs/La Cucaracha.mid","title":"La Cucaracha","source":"builtin","id":"ba3bed184b79d04a48a19913ff29d6da","duration":47}]')}},function(e){e.O(0,[512,656,831,887,269,582,58,971,69,744],function(){return e(e.s=9802)}),_N_E=e.O()}]);